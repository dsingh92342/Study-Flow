<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile - Study Flow</title>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <i class="fas fa-book-reader"></i>
                <span>Study Flow</span>
            </div>
            <div class="nav-links">
                <a href="dashboard-provider.html">Dashboard</a>
                <a href="browse-jobs.html">Browse Jobs</a>
                <a href="portfolio.html">Portfolio</a>
                <a href="#" onclick="logout(); return false;">Logout</a>
            </div>
        </div>
    </nav>

    <div class="profile-header">
        <div class="container">
            <div class="profile-content" id="profileContent">
                <!-- Profile content loaded here -->
            </div>
        </div>
    </div>

    <div class="dashboard container">
        <div class="profile-body">
            <div>
                <div class="profile-section">
                    <h3>Portfolio Items</h3>
                    <div id="profilePortfolio" class="portfolio-grid">
                        <!-- Portfolio items loaded here -->
                    </div>
                    <div style="text-align: center; margin-top: 20px;">
                        <a href="portfolio.html" class="btn-primary">
                            <i class="fas fa-plus"></i> Manage Portfolio
                        </a>
                    </div>
                </div>

                <div class="profile-section">
                    <h3>Completed Jobs</h3>
                    <div id="completedJobsList" class="cards-grid">
                        <!-- Completed jobs loaded here -->
                    </div>
                </div>
            </div>

            <div>
                <div class="profile-section">
                    <h3>Account Information</h3>
                    <div class="form-group">
                        <label>Full Name</label>
                        <input type="text" id="profileName" readonly style="background: var(--light-gray);">
                    </div>
                    <div class="form-group">
                        <label>Email</label>
                        <input type="email" id="profileEmail" readonly style="background: var(--light-gray);">
                    </div>
                    <div class="form-group">
                        <label>User Type</label>
                        <input type="text" id="profileType" readonly style="background: var(--light-gray);">
                    </div>
                </div>

                <div class="profile-section">
                    <h3>Statistics</h3>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <div style="display: flex; justify-content: space-between; padding: 15px; background: var(--light-gray); border-radius: var(--border-radius);">
                            <span><strong>Total Jobs Completed:</strong></span>
                            <span id="statCompleted">0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 15px; background: var(--light-gray); border-radius: var(--border-radius);">
                            <span><strong>Total Earnings:</strong></span>
                            <span id="statEarnings" style="color: var(--success-color); font-weight: bold;">$0</span>
                        </div>
                        <div style="display: flex; justify-content: space-between; padding: 15px; background: var(--light-gray); border-radius: var(--border-radius);">
                            <span><strong>Average Rating:</strong></span>
                            <span id="statRating" class="rating">
                                <span id="ratingStars"></span>
                                <span id="ratingText" class="rating-text"></span>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/auth.js"></script>
    <script src="js/dashboard.js"></script>
    <script src="js/portfolio.js"></script>
    <script src="js/jobs.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkAuth('provider')) return;
            loadProfile();
        });

        function loadProfile() {
            const currentUser = getCurrentUser();
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const user = users.find(u => u.id === currentUser.id);
            
            if (!user) return;

            // Load profile header
            const rating = user.rating || 0;
            const ratingStars = generateStars(rating);
            
            document.getElementById('profileContent').innerHTML = `
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="profile-info">
                    <h2>${user.name}</h2>
                    <div class="rating" style="margin: 15px 0;">
                        ${ratingStars}
                        <span class="rating-text">(${rating} / 5.0)</span>
                    </div>
                    <div class="profile-meta">
                        <span><i class="fas fa-briefcase"></i> ${user.completedJobs || 0} Jobs Completed</span>
                        <span><i class="fas fa-dollar-sign"></i> $${(user.totalEarnings || 0).toFixed(2)} Earned</span>
                        <span><i class="fas fa-calendar"></i> Joined ${new Date(user.createdAt).toLocaleDateString()}</span>
                    </div>
                </div>
            `;

            // Load account info
            document.getElementById('profileName').value = user.name;
            document.getElementById('profileEmail').value = user.email;
            document.getElementById('profileType').value = user.userType === 'provider' ? 'Provider' : 'Student';

            // Load statistics
            document.getElementById('statCompleted').textContent = user.completedJobs || 0;
            document.getElementById('statEarnings').textContent = '$' + (user.totalEarnings || 0).toFixed(2);
            document.getElementById('ratingStars').innerHTML = ratingStars;
            document.getElementById('ratingText').textContent = rating > 0 ? `(${rating} / 5.0)` : 'No ratings yet';

            // Load portfolio
            const portfolio = getPortfolio(currentUser.id);
            const portfolioContainer = document.getElementById('profilePortfolio');
            
            if (portfolio.length === 0) {
                portfolioContainer.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">No portfolio items yet.</p>';
            } else {
                portfolioContainer.innerHTML = portfolio.slice(0, 3).map(item => `
                    <div class="portfolio-item">
                        <div class="portfolio-image">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="portfolio-content">
                            <h4>${item.title}</h4>
                            <p><strong>Subject:</strong> ${item.subject}</p>
                        </div>
                    </div>
                `).join('');
            }

            // Load completed jobs
            const jobs = getJobs();
            const completedJobs = jobs.filter(j => j.acceptedBy === currentUser.id && j.status === 'completed');
            const jobsContainer = document.getElementById('completedJobsList');

            if (completedJobs.length === 0) {
                jobsContainer.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">No completed jobs yet.</p>';
            } else {
                jobsContainer.innerHTML = completedJobs.slice(0, 5).map(job => `
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">${job.title}</h3>
                            <span class="card-badge badge-completed">Completed</span>
                        </div>
                        <div class="card-meta">
                            <span><i class="fas fa-book"></i> ${job.subject}</span>
                            <span><i class="fas fa-user"></i> ${job.postedByName}</span>
                        </div>
                        <div class="card-footer">
                            <div class="card-price">$${(job.budget * 0.8).toFixed(2)}</div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            
            return stars;
        }
    </script>
</body>
</html>
